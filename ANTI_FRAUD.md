# Anti-Fraud Measures

Согласно ТЗ и дополнениям, реализованы и предусмотрены следующие меры:

## 1. Один человек = один аккаунт

- **Телефон:** поле `phone` в User с ограничением `@unique`
- При регистрации проверяется, что номер не занят
- Рекомендация: добавить SMS-верификацию телефона (Phase 2)

## 2. Кешбек только после 14 дней

- Поле `availableAt` в CashbackEntry = дата доставки + 14 дней
- Статус `PENDING` до наступления `availableAt`
- Cron-задача `processAvailableCashback()` переводит в `AVAILABLE`

## 3. Проверка по IMEI и оплате

- В Order хранится `imei` после отправки
- **Бесплатный iPhone при 20 рефералах** — реализовано:
  - Условие: 20 рефералов, которые купили (DELIVERED) в течение последнего года
  - Ручная проверка и выдача в админке (`/admin/free-iphone`)
  - Создание заказа с `isFreeiPhoneBonus: true`, total=0
- Рекомендация: верификация IMEI на дубликаты по всей БД

## 4. Дополнительные ограничения

- **Возвраты:** при статусе заказа REFUNDED — отмена начислений кешбека (Cancelled)
- **Блокировка:** `isBlocked` у User — доступ к ЛК закрыт
- **Лимиты:** минимальная сумма вывода $10 (настраиваемо в SystemSetting)

## Рекомендации для Phase 2

- [ ] SMS-верификация телефона (Twilio, etc.)
- [ ] Проверка дубликатов: один IP / один платёжный метод
- [ ] Задержка начисления кешбека по рефералам (например, 30 дней)
- [x] Ручная модерация заявок на бесплатный iPhone (реализовано в админке)
- [ ] Rate limiting на API регистрации и логина
- [ ] reCAPTCHA v3 на формах
